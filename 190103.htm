<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8" />
<title>title</title>
<meta http-equiv="Cache-Control" content="no-cache, no-store, max-age=0, must-revalidate">
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="expires" content="0" />

<style>
body{}
</style>

<script>
document.addEventListener("DOMContentLoaded",function(e){
	//取得hash的網址字串
	var url='';
	url=window.location;
	//console.log( url.hash );
	url=url.hash.substr(1);
	//console.log( url );
	url = new URL( url );
	//console.log( url );
	if( url.host == 'pbs.twimg.com' ){
	  //沒事
	}else{
	  throw '錯誤'+url.host;
	}
	//取得網址裡的參數
	var urlhash_format =url.searchParams.get('format');
	var urlhash_name   =url.searchParams.get('name');
	//console.log( urlhash_format,urlhash_name );
	
	var str='';
	if( urlhash_format == 'jpg' || urlhash_format == 'png' ){
		//沒事
		str=url.href.split("?")[0] + '.' + urlhash_format;
		//https://pbs.twimg.com/media/D2g4G9YU8AAc_QC.jpg
	}else{
		str=url.href;
		str=str.split(':'); //字元分割 
		str=str[0]+':'+str[1];
		//https://pbs.twimg.com/media/D2g4G9YU8AAc_QC.jpg
		//throw '錯誤'+urlhash_format;
	}
	//console.log( str );
	//url.searchParams.set('name','4096x4096');
	//url.searchParams.set('name','orig');
	//console.log( url );
	
	//console.log( new_url );
	//console.log( new_url.pathname );
	//console.log( new_url.pathname.split("\/")[2] );
	var new_url = new URL( str );
	//console.log( new_url );
	var nn=new_url.pathname.split("\/")[2];
	nn=nn.split(".")[0] +'_orig.'+ nn.split(".")[1];

	
	var url=''+new_url+':orig';
	

 
  //
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function(){
	if(this.readyState == 4 && this.status == 200){
		//console.log(this.response, typeof this.response);
		console.log(nn);
		var img = document.getElementById('img01');
		img.onload = function(){
			var str=''+img.naturalWidth+'x'+img.naturalHeight+' '+nn;
			//console.log(str);
			img.insertAdjacentHTML('beforebegin', str+'<br/>');
			document.title=''+str;
			//
			var aa = document.getElementById('aa01');
			aa.href = img.src;
			aa.download=''+nn;
			aa.click();

		};
		img.src = window.URL.createObjectURL(this.response);
/*
		var aa = document.getElementById('aa01');
		aa.href = window.URL.createObjectURL(this.response);
		aa.download=''+nn;
		aa.click();

*/


		//var win = window.open("about:blank", "_self");
		//win.close();
		//window.top.close();
	}//if
	}//xhr
	xhr.open('GET', url);
	xhr.responseType = 'blob';
	xhr.send();      

});





/*
$(document).ready(function(){
  var url='https://pbs.twimg.com/media/Dv6TGrKU8AALiBt.jpg';
  $('#iframe01').attr('src',url);
});

*/

/*
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200){
      console.log(this.response, typeof this.response);
      var img = document.getElementById('img01');
      img.src = window.URL.createObjectURL(this.response);
      var aa = document.getElementById('aa01');
      aa.href = window.URL.createObjectURL(this.response);
      aa.download='download.jpg';
      aa.click();
    }
  }
  xhr.open('GET', url);
  xhr.responseType = 'blob';
  xhr.send();      

*/
/*
  var ajax01=$.ajax({
    url: url,
    xhrFields:{
      responseType: 'blob'
    },
    success: function(a,b,c){            
      var blobData = a;
      var blob_url = window.URL.createObjectURL(a);
      $('#img02').attr("src", blob_url);      
      $('#aa02').attr("href", blob_url);
      $('#aa02').attr("download", 'download.jpg');
      //$('#aa02').trigger("click");
      $('#aa02')[0].click();
      //
    }
  });

*/

/*

*/
</script>

</head>
<body>
<a id="aa01" href="">下載</a>
<br>
<img id="img01">



</body>
</html>
